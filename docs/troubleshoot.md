# Устранение проблем и ошибок

!!! bug "При возникновении любых проблем и ошибок сперва загляните в журнал Home Assistant: `Настройки` --> `Система` --> [`Журнал сервера`](https://my.home-assistant.io/redirect/logs/)"

## Устройство не появляется в УДЯ/Марусе { id=missing-device }

* Убедитесь, что:
     1. Объект, для которого будет создано устройство, выбран в [списке объектов для передачи в УДЯ](./config/filter.md)
     2. Объект есть в [списке поддерживаемых устройств](./supported-devices.md) (особенно актуально для датчиков без `device_class`)
     3. Состояние объекта не `unavailable` (если устройство отключено от питания - включите его)
     4. В [`Журнале сервера`](https://my.home-assistant.io/redirect/logs/) нет ошибок

* Перезапустите Home Assistant
* УДЯ: Выполните ручное [Обновление списка устройств](./platforms/yandex.md#discovery)
* Маруся: Принудительно закройте приложение Маруся и откройте снова

Если это не помогло - создайте [issue](https://github.com/dext0r/yandex_smart_home/issues) или напишите в [чат](https://t.me/yandex_smart_home).
К сообщению приложите:

* **ID** и **атрибуты** проблемных объектов: их можно найти в `Панель разработчика` > `Состояния`
  ![](./assets/images/entity-state.png){ width=700 }

* Диагностические данные интеграции (`Настройки` --> `Устройства и службы` --> [`Интеграции`](https://my.home-assistant.io/redirect/integrations/) --> `Yandex Smart Home` --> :fontawesome-solid-ellipsis-vertical: --> `Скачать диагностические данные` у проблемной интеграции)
* Для облачного подключения:
    * Первые 6 символов вашего ID (можно посмотреть в [настройках интеграции](./config/getting-started.md#gui))
    * Дату и время обновления списка устройств

## Устройство в УДЯ/Марусе поддерживает не все функции { id=blinking-features }

Некоторые устройства изменяют список поддерживаемых функций в зависимости от своего состояния. Особенно часто это поведение замечено за `media_player`.

Если в УДЯ у устройства отсутствует функция, которая точно должна быть - попробуйте [Обновить список устройств](./platforms/yandex.md#discovery) при включенном устройстве, в Марусе - перезапустите приложение.

Так же может помочь настройка [`features`](./config/entity.md#features) для явного указания поддерживаемых устройством функций.

## Устройство отвязалось (УДЯ) { id=unlinked }

Необходимо вручную [Обновить список устройств](./platforms/yandex.md#discovery), но сделать это не из списка навыков, а **зайти в навык** и нажать там кнопку `Обновить список устройств` или `Привязать к Яндексу`.

## Пропали все устройства (Маруся) { id=devices-gone }

Устройства пропадают из Маруси если не был получен ответ от Home Assistant, при этом в приложении никакая ошибка отображена на будет.

* Убедитесь, что в [`Журнале сервера`](https://my.home-assistant.io/redirect/logs/) нет ошибок
* Полностью перезагрузите приложение Маруся
* Для прямого подключения: убедитесь, что Home Assistant доступен из интернета
* Для облачного подключения: напишите в [чат](https://t.me/yandex_smart_home) в Telegram указав первые 6 символов вашего ID (можно посмотреть в [настройках интеграции](./config/getting-started.md#gui))

## Device for XXX exists in Yandex, but entity XXX not exposed { id=unexposed-entity }

В УДЯ присутствует устройство, но объект, по которому оно создано, не выбран в [объектах для передачи в УДЯ](./config/filter.md).

Для исправления: удалите устройство из УДЯ или добавьте [объект](./faq.md#get-entity-id-app) в список устройств для передачи.

## Unsupported mode "XXX" { id=unsupported-mode }

Не удалось сопоставить режим из Home Assistant c режимом в УДЯ. Если нет необходимости выбирать проблемные режимы - ошибку можно игнорировать.

Для исправления: настройте [связь режимов](./config/modes.md) УДЯ <--> HA

## State notification request failed

Ряд ошибок, которые могут возникает при отправке в УДЯ уведомлений об изменении состояний устройств. Ошибки могут возникать периодически - это нормально. Если ошибок мало - просто очистите журнал.

### State notification request failed: UNKNOWN_USER { id=unknown-user }

* Вручную [обновите список устройств](./platforms/yandex.md#discovery)
* Для прямого подключения: убедитесь, что в параметрах навыка в [настройках интеграции](./config/getting-started.md#gui) выбран пользователь, который использовался при привязке Home Assistant к УДЯ

### State notification request failed: Unauthorized { id=notifier-unauthorized }

Только для прямого подключения: обновите токен в параметрах навыка в [настройках интеграции](./config/getting-started.md#gui) и убедитесь, что указан верный Идентификатор диалога
